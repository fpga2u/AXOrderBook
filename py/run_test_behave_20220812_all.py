# -*- coding: utf-8 -*-

import traceback
import logging
import datetime
from time import localtime
import os
import behave.test.test_axob as behave
from tool.axsbe_base import INSTRUMENT_TYPE, SecurityIDSource_SZSE

if __name__== '__main__':
    myname = os.path.split(__file__)[1][:-3]
    mytime = str(datetime.datetime(*localtime()[:6])).replace(':',"").replace('-',"").replace(" ","_")

    logger = logging.getLogger('main')
    logger.setLevel(logging.DEBUG)

    fh = logging.FileHandler(f'log/{myname}_{mytime}.log')
    # fh = logging.FileHandler(f'log/{myname}.log', mode='w')
    fh.setLevel(logging.DEBUG)

    sh = logging.StreamHandler()
    sh.setLevel(logging.WARNING)

    formatter_ts = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
    formatter_nts = logging.Formatter('%(name)s - %(levelname)s - %(message)s')
    fh.setFormatter(formatter_nts)
    sh.setFormatter(formatter_ts)

    logger.addHandler(fh)
    logger.addHandler(sh)
    logPack = logger.debug, logger.info, logger.warn, logger.error

    ###测试20220812所有有委托的只股票，全天【pass@22/11/25(D.T.)】
    fh.setLevel(logging.INFO)
    sh.setLevel(logging.ERROR)
    logger.info('starting TEST_axob_bat')
    # data_source = "H:/AXOB_data_newP/20220812/sbe_20220812_all.log"
    data_source = "H:/AXOB_data_newP_ru/20220812/sbe_20220812_all.log"
    all_inc=[200054, 200045, 200512, 200152, 200011, 200019, 200055, 200429, 300492, 200521, 200029, 752, 301122, 2319, 300069, 200056, 200596, 2692, 300592, 2200, 2052, 300622, 23, 3004, 301033, 2700, 300089, 2836, 301080, 300645, 300286, 2778, 638, 300525, 300426, 300523, 301062, 300374, 300656, 906, 300870, 300149, 3017, 301025, 300955, 300789, 301037, 301070, 200539, 2259, 300508, 2122, 300695, 300399, 2816, 2872, 2592, 300489, 300380, 300729, 2972, 2832, 2830, 300791, 2840, 300833, 2817, 2986, 300907, 300906, 300258, 301128, 2940, 971, 2336, 2857, 301186, 300670, 2910, 300930, 2942, 301162, 2615, 300371, 2889, 301004, 301022, 3005, 300462, 2264, 2211, 301063, 2668, 300757, 300854, 300788, 300550, 300823, 2021, 2870, 300971, 300808, 300651, 300844, 300865, 2811, 300445, 2767, 300596, 553, 300798, 300892, 2282, 300718, 2831, 300298, 2678, 1266, 200488, 300811, 300515, 3003, 300277, 2875, 300716, 3029, 300858, 411, 3018, 300779, 300341, 300385, 300406, 301019, 300845, 2250, 2800, 301159, 300819, 300417, 300419, 301031, 300667, 2293, 300918, 301077, 300096, 2835, 300619, 301073, 300950, 300851, 300822, 300960, 301000, 2609, 2919, 300836, 2793, 300313, 300542, 300941, 300488, 301218, 759, 300952, 2659, 668, 2937, 301043, 300680, 2098, 301099, 301107, 300796, 301051, 2780, 42, 300942, 985, 2289, 2729, 2656, 300154, 2956, 300817, 2855, 300314, 2634, 301111, 2742, 300626, 300989, 300257, 301024, 2899, 300993, 300767, 300878, 2743, 803, 300826, 300946, 2981, 2691, 2787, 300254, 300411, 2485, 300591, 534, 300381, 300911, 48, 300936, 300029, 1206, 300920, 3036, 659, 1914, 2890, 301167, 2003, 300864, 300746, 300707, 300862, 300885, 300210, 200012, 20, 2058, 300781, 300908, 300486, 2776, 300683, 300246, 300637, 300512, 300868, 300829, 2187, 590, 300631, 301009, 2102, 3031, 300360, 2658, 2040, 2105, 2768, 1209, 301072, 300011, 2774, 3023, 300765, 301057, 2790, 2853, 300985, 301116, 300535, 300966, 300780, 300464, 557, 301096, 300756, 300575, 300797, 300126, 300898, 2675, 301201, 301050, 633, 301191, 300605, 301098, 301102, 300610, 300912, 2544, 3008, 300519, 301212, 300562, 301003, 301067, 300894, 5, 30, 300961, 929, 2566, 300686, 300899, 300501, 881, 300685, 300320, 719, 2054, 802, 300584, 2946, 301049, 300016, 301126, 300558, 1217, 3041, 2423, 301288, 669, 2556, 300881, 300973, 300268, 2852, 2006, 2881, 301156, 300608, 2637, 300340, 301182, 2858, 300226, 300761, 2971, 300151, 300725, 300538, 300421, 2321, 300169, 301239, 300616, 1201, 300634, 2395, 300856, 300978, 910, 919, 529, 2696, 2653, 2360, 300593, 300454, 300560, 300516, 300921, 2492, 2891, 153, 705, 300561, 720, 300289, 2616, 301106, 2998, 300910, 300913, 300927, 2718, 663, 2462, 300571, 300859, 2851, 301263, 301041, 300291, 2324, 850, 2900, 300004, 2228, 2969, 300917, 955, 300143, 300752, 301220, 3032, 300484, 2984, 2856, 300127, 2878, 913, 300453, 698, 2025, 301069, 2792, 300992, 301298, 300533, 300141, 2643, 2442, 301058, 3012, 2524, 300979, 2343, 300138, 300427, 2775, 301136, 2180, 300221, 300981, 2315, 2789, 300841, 300368, 2196, 3000, 818, 28, 300755, 301125, 300945, 2198, 3016, 2096, 573, 300306, 300288, 300597, 300174, 2841, 300890, 2671, 300332, 300071, 300638, 3015, 2879, 2483, 301258, 2751, 1296, 301038, 300572, 301082, 2557, 430, 301131, 300495, 2667, 300628, 2918, 301222, 2574, 2019, 300957, 2977, 301229, 300050, 300681, 301032, 300247, 2887, 300832, 605, 300988, 3007, 31, 2873, 11, 300787, 2867, 300152, 301086, 300497, 300201, 300880, 1317, 886, 524, 2438, 300872, 300309, 2677, 1316, 300665, 708, 2301, 301151, 2358, 300513, 300225, 300140, 301137, 301177, 2769, 300084, 300922, 2782, 2417, 300539, 301093, 989, 1202, 300259, 2012, 300466, 2652, 300295, 300612, 300106, 300553, 948, 300359, 300846, 301133, 2978, 2299, 300693, 2227, 2837, 2294, 301091, 3028, 301279, 300556, 701, 2638, 300713, 2798, 300161, 300896, 300333, 300272, 300195, 300834, 300107, 2375, 300948, 300137, 589, 3037, 2114, 2629, 301302, 300770, 300153, 300105, 300350, 2141, 301071, 2650, 520, 2137, 2087, 593, 300792, 300168, 300563, 300679, 300214, 2028, 2214, 2672, 2140, 2962, 301060, 2318, 300278, 532, 2581, 300721, 300424, 2848, 300109, 300712, 2522, 2590, 2189, 2728, 2372, 1216, 300956, 2365, 300882, 2753, 820, 300280, 300100, 2053, 2209, 715, 300063, 607, 2295, 300171, 2208, 301078, 2491, 3019, 2306, 2042, 2693, 300191, 626, 2846, 300082, 2641, 2833, 300580, 300647, 301127, 813, 300905, 677, 2905, 852, 2882, 301312, 2089, 711, 892, 885, 300452, 300696, 2645, 300511, 2046, 6, 859, 300181, 38, 300617, 2773, 301103, 2243, 300042, 558, 300157, 2597, 300179, 2752, 2702, 2332, 300763, 2947, 2850, 721, 967, 2088, 300113, 300603, 301007, 2820, 2111, 2093, 301187, 300188, 2262, 301030, 2392, 301211, 417, 428, 2950, 300487, 300443, 2378, 2535, 2303, 2094, 301181, 2445, 301234, 300365, 2134, 2551, 2032, 2941, 785, 2701, 2540, 300213, 300134, 856, 300162, 761, 655, 2397, 2296, 2548, 2806, 301112, 2571, 2458, 300830, 300745, 300604, 889, 639, 1226, 962, 2443, 300674, 1336, 2661, 2314, 200725, 300183, 2796, 300692, 2479, 2279, 300465, 2265, 300128, 691, 1228, 2622, 2642, 300648, 300807, 2480, 300532, 300587, 2055, 2461, 2059, 416, 657, 2193, 2683, 16, 923, 300943, 407, 2906, 917, 862, 981, 2026, 300240, 2390, 996, 300187, 300598, 301123, 300866, 993, 300311, 2828, 554, 300318, 789, 2307, 560, 782, 300147, 531, 300939, 888, 2242, 300093, 2827, 900, 2457, 635, 300412, 300441, 2207, 928, 300139, 301155, 301196, 301109, 300066, 2290, 2474, 2308, 2766, 300095, 300228, 2418, 2993, 300145, 726, 301028, 2154, 300297, 2346, 566, 300396, 17, 672, 2822, 622, 300085, 1319, 2545, 300267, 685, 300040, 958, 1203, 2158, 2244, 1896, 300526, 300305, 300199, 300172, 2842, 829, 300611, 833, 300850, 2225, 2110, 300481, 301215, 301092, 301236, 300377, 788, 300013, 300448, 2801, 300786, 300198, 920, 300510, 415, 300078, 897, 570, 2563, 791, 735, 809, 718, 300020, 2598, 2085, 2433, 1318, 666, 2170, 2516, 300620, 2662, 2843, 2210, 2554, 620, 2446, 1207, 1267, 2951, 300197, 2707, 2943, 300061, 581, 2565, 2302, 300602, 300468, 300256, 823, 301333, 2347, 3035, 716, 300463, 2075, 2486, 949, 300429, 3002, 905, 2174, 300021, 300087, 731, 300194, 2362, 800, 300292, 301219, 300496, 89, 300047, 300671, 300672, 544, 300607, 631, 2772, 2136, 2322, 300676, 420, 816, 903, 2258, 300159, 300229, 2654, 2663, 2895, 2737, 2682, 300212, 2166, 2150, 839, 300091, 2922, 55, 301039, 300586, 2118, 2498, 848, 300322, 2373, 2985, 516, 70, 926, 300438, 300400, 300330, 536, 2552, 2546, 300825, 819, 3021, 402, 300650, 300039, 300444, 90, 2550, 738, 78, 2280, 2708, 2444, 918, 2510, 2234, 301021, 729, 2620, 300317, 2169, 300428, 300802, 2917, 403, 300748, 300146, 2310, 300573, 300222, 2068, 521, 2948, 975, 2304, 2511, 2953, 2355, 300009, 2106, 300304, 539, 751, 2041, 980, 2812, 300219, 2612, 301059, 423, 300398, 810, 300364, 2274, 550, 999, 927, 2783, 300224, 2669, 300657, 2063, 300363, 2248, 2155, 2263, 2182, 2876, 1268, 2354, 909, 408, 2756, 2269, 300237, 300253, 300301, 300991, 2921, 2549, 2164, 2261, 882, 2100, 600, 2717, 300053, 2128, 2298, 2382, 623, 27, 2657, 300031, 2636, 300708, 2073, 968, 300480, 404, 300083, 300041, 2251, 2288, 300706, 300601, 2902, 2023, 300477, 2886, 541, 50, 301278, 300315, 2765, 300629, 301018, 997, 2400, 2284, 584, 300251, 2370, 300184, 563, 2613, 300347, 2623, 860, 2508, 300120, 2125, 2130, 300073, 300158, 543, 681, 650, 300276, 2935, 300565, 2489, 2648, 300263, 2348, 2455, 2866, 2909, 815, 35, 2312, 300094, 300035, 2958, 300413, 938, 300323, 2505, 2997, 2292, 2587, 875, 2014, 300677, 2297, 586, 826, 301040, 2431, 300623, 988, 2413, 2138, 2050, 2987, 65, 2191, 2049, 300554, 300793, 2177, 2591, 2383, 682, 2425, 2996, 300666, 2530, 300474, 982, 755, 300335, 2316, 58, 2437, 552, 2239, 300033, 537, 2507, 300337, 2083, 2323, 545, 301175, 300166, 2523, 2024, 599, 300472, 678, 2681, 300782, 301135, 300118, 300758, 601, 300296, 300507, 300003, 300037, 2493, 300223, 2699, 300727, 2745, 300376, 822, 2607, 300963, 2500, 300124, 2121, 155, 2733, 757, 300303, 2364, 300308, 963, 2911, 2132, 2092, 2689, 636, 300569, 933, 2589, 661, 69, 2350, 300008, 2606, 2146, 66, 932, 2936, 300241, 1208, 799, 750, 587, 538, 768, 301318, 12, 825, 2414, 2421, 21, 300115, 895, 2602, 756, 2503, 301095, 2060, 2517, 2532, 2367, 300261, 667, 665, 2061, 998, 2593, 2411, 300537, 422, 300204, 2326, 2157, 2160, 2035, 2352, 2011, 301217, 2739, 300663, 300831, 2030, 876, 762, 709, 300177, 300346, 2142, 2747, 2725, 2245, 2230, 300339, 2273, 300142, 300058, 2456, 2454, 1227, 801, 300097, 2938, 300373, 300459, 2539, 591, 2405, 2520, 2712, 2809, 400, 2537, 300328, 2202, 300068, 2761, 2341, 301192, 300393, 2797, 300015, 63, 338, 506, 3816, 301308, 2404, 656, 2387, 300410, 300014, 2217, 2926, 2860, 2506, 807, 2161, 2115, 2272, 547, 300088, 2062, 2610, 564, 2415, 2594, 792, 776, 301269, 2560, 301336, 2709, 2008, 2340, 651, 100, 300735, 2328, 2119, 2036, 2957, 2512, 1, 2519, 2903, 2337, 1229, 530, 2665, 2579, 725, 625, 2231, 2045, 2241, 300059, 1236, 2079, 40, 1258]

    try:
        behave.TEST_mu_bat(data_source, all_inc, batch_nb=16, bgn_batch=0, SecurityIDSource=SecurityIDSource_SZSE, instrument_type=INSTRUMENT_TYPE.STOCK, logPack=logPack) #
    except Exception as e:
        logger.error(f'{traceback.format_exc()}')
