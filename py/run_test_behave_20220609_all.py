# -*- coding: utf-8 -*-

import traceback
import logging
import datetime
from time import localtime
import os
import behave.test.test_axob as behave
from tool.axsbe_base import INSTRUMENT_TYPE, SecurityIDSource_SZSE

if __name__== '__main__':
    myname = os.path.split(__file__)[1][:-3]
    mytime = str(datetime.datetime(*localtime()[:6])).replace(':',"").replace('-',"").replace(" ","_")

    logger = logging.getLogger('main')
    logger.setLevel(logging.DEBUG)

    fh = logging.FileHandler(f'log/{myname}_{mytime}.log')
    # fh = logging.FileHandler(f'log/{myname}.log', mode='w')
    fh.setLevel(logging.DEBUG)

    sh = logging.StreamHandler()
    sh.setLevel(logging.WARNING)

    formatter_ts = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
    formatter_nts = logging.Formatter('%(name)s - %(levelname)s - %(message)s')
    fh.setFormatter(formatter_nts)
    sh.setFormatter(formatter_ts)

    logger.addHandler(fh)
    logger.addHandler(sh)
    logPack = logger.debug, logger.info, logger.warn, logger.error

    ###测试20220617所有有委托的只股票，全天
    fh.setLevel(logging.WARN)
    sh.setLevel(logging.ERROR)
    logger.info('starting TEST_axob_bat')
    data_source = "H:/AXOB_data_newP/20220609/sbe_20220609_all.log"
    all_inc=[200045, 200512, 200706, 200613, 200468, 200037, 200028, 200992, 200553, 300736, 200505, 300795, 200581, 200429, 2200, 300757, 200026, 2857, 200025, 200029, 2760, 301129, 300553, 200056, 752, 200596, 300257, 200413, 300475, 300668, 300953, 300930, 586, 301128, 695, 300731, 300870, 2072, 300371, 300658, 301068, 300817, 301035, 2499, 301057, 2778, 300492, 2586, 301051, 2816, 300622, 300522, 300615, 300654, 2715, 2930, 200869, 2134, 301075, 300405, 301122, 300932, 2972, 300656, 300912, 300445, 2356, 971, 890, 2823, 301029, 300345, 2289, 2633, 668, 2889, 301006, 301019, 45, 300549, 300851, 301062, 2058, 3036, 300721, 300517, 301037, 300865, 3017, 300518, 300906, 2632, 300800, 301008, 638, 300918, 300683, 300964, 2942, 2981, 2947, 300713, 2832, 300109, 2802, 300852, 504, 301036, 300960, 2979, 2975, 300265, 300512, 300837, 300854, 2199, 2054, 2951, 300839, 3028, 200012, 300235, 2634, 2795, 301066, 300995, 23, 806, 2668, 3020, 2730, 301169, 300407, 2395, 300594, 403, 300400, 2336, 2862, 300126, 300246, 534, 2331, 2779, 300822, 2859, 2741, 300828, 3023, 300150, 300281, 300761, 300442, 300399, 300920, 2866, 300705, 2829, 300911, 301106, 2940, 2913, 300690, 2792, 300657, 2927, 2535, 300491, 2984, 300097, 2014, 301182, 300538, 2937, 301178, 301030, 300915, 300277, 300536, 300682, 300788, 300659, 300593, 300939, 300805, 300711, 300862, 3025, 3027, 2871, 301086, 300614, 300378, 300417, 2203, 300856, 301097, 300626, 3006, 2295, 2696, 2388, 200488, 2861, 2653, 300733, 300936, 300840, 300341, 906, 300488, 301096, 300818, 300991, 2961, 301199, 300029, 300566, 300802, 300987, 3003, 300793, 972, 3029, 300857, 2899, 2868, 301005, 300392, 300836, 300330, 2892, 301149, 300226, 300871, 2831, 4, 300620, 2684, 300814, 301021, 809, 300947, 2337, 3015, 2827, 2777, 300469, 300628, 301024, 300819, 300886, 1202, 300938, 301235, 2609, 300949, 2427, 300402, 300808, 531, 2324, 301099, 300453, 300293, 300473, 300641, 300141, 410, 300679, 300149, 300807, 300414, 301007, 300430, 2952, 300983, 2012, 2992, 2989, 300838, 2494, 300384, 2731, 2842, 300514, 2674, 300985, 300976, 300665, 300571, 2333, 300258, 300907, 301186, 300715, 300562, 300941, 2956, 300563, 2376, 300767, 300616, 801, 300796, 300858, 300210, 2853, 2147, 300799, 300892, 300585, 300726, 300660, 2909, 300909, 301108, 300537, 300844, 300076, 2767, 587, 3008, 300966, 300570, 409, 300564, 300973, 2393, 300385, 300155, 2321, 300243, 300931, 300880, 300887, 702, 300942, 2381, 2278, 2825, 300765, 300403, 2719, 300702, 2763, 300609, 300351, 300968, 300719, 300365, 2637, 2774, 300093, 300958, 300449, 300706, 2833, 300743, 2768, 605, 2032, 301093, 301196, 2970, 300644, 2544, 2107, 301061, 300064, 2690, 300446, 300937, 2875, 300894, 2911, 300640, 300457, 2675, 915, 2391, 300899, 301002, 300580, 2771, 300353, 300903, 301279, 2260, 2345, 2168, 1215, 3000, 2643, 2678, 2998, 952, 2574, 300673, 300139, 2347, 300951, 300441, 300624, 2886, 300349, 301221, 2238, 2666, 300577, 2912, 300610, 2211, 300604, 301059, 300406, 593, 2560, 3012, 301077, 301085, 300993, 300112, 2801, 300004, 300956, 300500, 300269, 300630, 2559, 301025, 300627, 2214, 300889, 300501, 301237, 2615, 300486, 300307, 2583, 1288, 300735, 300386, 300747, 300873, 300270, 2654, 2227, 301229, 2880, 300678, 626, 300424, 2631, 300107, 300151, 300586, 300016, 1216, 300195, 2946, 300925, 300597, 30, 532, 2698, 300927, 300653, 2318, 2910, 300528, 2543, 2582, 2524, 613, 300175, 948, 301248, 300329, 300054, 2818, 919, 2372, 850, 300289, 597, 2016, 869, 300143, 301071, 2025, 300368, 2799, 300565, 705, 1914, 2117, 300755, 301190, 300972, 300992, 300221, 300504, 301189, 2641, 2522, 300587, 720, 300256, 2247, 300605, 2006, 301050, 2086, 2622, 48, 2441, 300236, 2798, 37, 2820, 2627, 2452, 300340, 300722, 2138, 759, 1696, 2811, 996, 300057, 2753, 2099, 300556, 2679, 300132, 301102, 301103, 2770, 2423, 2077, 301258, 300730, 301166, 3001, 2900, 300638, 300510, 300766, 2671, 2850, 2180, 300375, 2841, 2959, 2556, 2718, 301150, 301162, 2908, 301091, 300322, 2557, 2815, 2995, 300843, 300283, 2094, 300891, 2173, 2749, 300776, 300506, 2399, 300072, 2360, 719, 2863, 300423, 698, 300771, 2817, 2918, 300567, 2906, 300763, 2920, 300301, 300320, 300245, 300617, 301158, 300209, 2398, 300487, 2040, 2412, 561, 2367, 2949, 300812, 42, 2148, 677, 300252, 300460, 2536, 2512, 885, 2681, 300526, 520, 737, 300464, 300357, 300337, 2445, 300135, 300323, 300268, 301018, 16, 300387, 2528, 2369, 156, 976, 2028, 300411, 300850, 300738, 300305, 300815, 300785, 2985, 2300, 300666, 301111, 300661, 300066, 2055, 818, 2788, 300382, 2089, 2190, 300584, 2928, 300412, 2644, 925, 300067, 2420, 28, 2733, 300576, 2344, 300055, 300310, 300241, 2109, 300006, 2106, 300276, 300168, 300454, 300045, 301257, 301040, 300612, 2800, 2410, 300082, 2454, 300041, 300427, 300940, 2523, 300740, 2262, 300575, 2471, 300485, 2483, 430, 2332, 567, 2606, 300278, 300591, 301201, 2716, 823, 2701, 300332, 2773, 2308, 301259, 1289, 2515, 2378, 300034, 300435, 2782, 2772, 300294, 973, 2172, 301200, 2093, 2196, 2572, 989, 2547, 2417, 2649, 573, 301179, 300888, 300247, 2962, 300053, 2533, 2775, 2184, 300279, 2869, 301078, 2746, 2793, 2587, 300007, 518, 2605, 2581, 2357, 300582, 68, 300152, 300981, 300732, 300926, 2480, 38, 637, 962, 2392, 300649, 2828, 2491, 301027, 2020, 2010, 2212, 2221, 300333, 300895, 2726, 2042, 301151, 2228, 407, 2298, 2363, 2087, 1208, 300741, 300228, 700, 838, 35, 2449, 300113, 2237, 301187, 300306, 300165, 2297, 2210, 36, 300048, 300831, 300456, 2640, 300177, 55, 1308, 301268, 2438, 301212, 2576, 300304, 300893, 2299, 2902, 2495, 301263, 2467, 300184, 300465, 301153, 2171, 300194, 300499, 2756, 2915, 300468, 300198, 300073, 2993, 415, 300672, 2808, 300527, 529, 300699, 2876, 300533, 988, 300145, 2329, 300325, 300511, 300664, 967, 300130, 2085, 2004, 300327, 524, 2440, 2514, 301207, 300244, 923, 300049, 2686, 3037, 627, 300558, 300692, 2217, 712, 2434, 2597, 2885, 26, 911, 300021, 59, 301088, 710, 2626, 301137, 300531, 300366, 2648, 685, 300358, 2353, 2179, 300655, 920, 300546, 2141, 917, 300063, 300098, 300618, 301055, 300890, 2291, 2242, 301048, 2005, 2167, 300415, 711, 2651, 300420, 31, 2943, 733, 2570, 300671, 2623, 2518, 300560, 300324, 2229, 428, 420, 300398, 300359, 2334, 2446, 300529, 2659, 301155, 2470, 559, 300437, 300688, 50, 301219, 300061, 969, 301136, 2023, 2629, 2133, 150, 2867, 928, 2486, 300328, 2498, 300027, 301090, 300541, 2439, 657, 300263, 678, 301236, 525, 300896, 1313, 2140, 889, 300133, 563, 2468, 2419, 300663, 2037, 2151, 2258, 300648, 717, 2938, 300129, 2635, 607, 2038, 300267, 300759, 300146, 6, 2189, 300062, 936, 14, 300623, 2355, 513, 560, 501, 2401, 905, 612, 2223, 2079, 2878, 2580, 300024, 11, 2702, 2075, 2650, 3010, 2294, 877, 3009, 528, 751, 300114, 300157, 2737, 2697, 2530, 2197, 539, 2745, 2281, 2968, 2824, 300253, 21, 416, 707, 300777, 676, 2765, 726, 893, 2350, 300136, 300036, 300102, 2396, 2059, 2575, 2351, 300568, 975, 2507, 2354, 682, 300409, 2986, 2108, 300208, 300020, 918, 2625, 985, 3040, 2948, 701, 2558, 596, 949, 2031, 300101, 2926, 897, 2447, 300159, 300458, 2274, 2590, 2646, 300079, 89, 2177, 2182, 300601, 2922, 2932, 2081, 786, 300002, 300008, 2169, 2162, 2805, 301120, 729, 423, 300552, 2549, 810, 488, 300037, 2465, 300001, 402, 300821, 2064, 300413, 90, 300311, 2685, 601, 2496, 300148, 300355, 300676, 2045, 2249, 2490, 861, 300376, 2154, 2015, 2789, 836, 2493, 2152, 2599, 300773, 300346, 300170, 545, 2958, 300347, 2548, 2135, 300017, 301193, 300507, 1228, 2856, 615, 517, 300309, 753, 970, 2838, 60, 300760, 887, 581, 686, 2759, 301191, 2437, 2585, 65, 540, 2206, 300115, 2612, 2370, 300012, 2717, 2883, 2511, 19, 2155, 301216, 882, 2163, 1212, 2532, 2456, 300144, 822, 523, 2664, 300393, 2663, 703, 300070, 953, 2723, 300117, 301183, 300147, 301160, 732, 2232, 862, 2139, 2207, 300091, 655, 2371, 2596, 300083, 2053, 300846, 300124, 2941, 2457, 8, 2325, 1213, 300598, 633, 300116, 505, 739, 2554, 930, 2192, 300373, 2317, 2191, 628, 2766, 2510, 300140, 768, 993, 790, 300497, 300317, 2936, 2589, 2481, 2128, 538, 543, 300701, 830, 2628, 898, 886, 2600, 582, 10, 799, 2277, 301215, 2146, 2538, 2667, 2602, 2061, 300182, 557, 2024, 2110, 300118, 300010, 2104, 816, 2057, 620, 680, 300505, 300075, 300207, 2185, 1979, 568, 300088, 683, 667, 2476, 300189, 883, 758, 2263, 2074, 66, 2529, 552, 2251, 2292, 2307, 2676, 2537, 2425, 2062, 300250, 2555, 300087, 2487, 2230, 157, 2738, 932, 983, 300343, 2639, 300261, 300122, 425, 2092, 2142, 300026, 2531, 807, 960, 860, 933, 2245, 2202, 300367, 300274, 547, 831, 2030, 2598, 2383, 166, 2241, 300339, 2561, 665, 300015, 2272, 564, 2007, 63, 2714, 338, 2066, 2426, 2565, 722, 821, 2460, 656, 2380, 2181, 2603, 2176, 2709, 2624, 9, 998, 333, 2256, 2482, 2240, 2265, 792, 2060, 2578, 2608, 2, 2284, 2121, 2349, 619, 2761, 2432, 2157, 756, 1270, 2385, 2607, 151, 25, 899, 300059, 966, 2594, 2630]

    try:
        behave.TEST_mu_bat(data_source, all_inc, batch_nb=16, bgn_batch=0, SecurityIDSource=SecurityIDSource_SZSE, instrument_type=INSTRUMENT_TYPE.STOCK, logPack=logPack) #
    except Exception as e:
        logger.error(f'{traceback.format_exc()}')
