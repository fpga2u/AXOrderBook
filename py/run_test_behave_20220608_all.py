# -*- coding: utf-8 -*-

import traceback
import logging
import datetime
from time import localtime
import os
import behave.test.test_axob as behave
from tool.axsbe_base import INSTRUMENT_TYPE, SecurityIDSource_SZSE

if __name__== '__main__':
    myname = os.path.split(__file__)[1][:-3]
    mytime = str(datetime.datetime(*localtime()[:6])).replace(':',"").replace('-',"").replace(" ","_")

    logger = logging.getLogger('main')
    logger.setLevel(logging.DEBUG)

    fh = logging.FileHandler(f'log/{myname}_{mytime}.log')
    # fh = logging.FileHandler(f'log/{myname}.log', mode='w')
    fh.setLevel(logging.DEBUG)

    sh = logging.StreamHandler()
    sh.setLevel(logging.WARNING)

    formatter_ts = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
    formatter_nts = logging.Formatter('%(name)s - %(levelname)s - %(message)s')
    fh.setFormatter(formatter_nts)
    sh.setFormatter(formatter_ts)

    logger.addHandler(fh)
    logger.addHandler(sh)
    logPack = logger.debug, logger.info, logger.warn, logger.error

    ###测试20220608所有有委托的只股票，全天
    fh.setLevel(logging.WARN)
    sh.setLevel(logging.ERROR)
    logger.info('starting TEST_axob_bat')
    data_source = "H:/AXOB_data_newP_ru/20220608/sbe_20220608_all.log"
    all_inc=[200706, 200045, 200512, 200019, 200030, 200028, 200037, 200553, 300354, 200550, 200026, 200056, 200016, 972, 586, 301051, 2072, 2890, 200613, 200726, 200025, 2200, 300492, 3033, 300731, 2740, 2778, 300984, 300103, 300930, 300257, 300392, 2802, 2134, 695, 2731, 2831, 301053, 2848, 301019, 2972, 2947, 301122, 300980, 2293, 300380, 300652, 300695, 300833, 301068, 2870, 3004, 2889, 300865, 2963, 301059, 2830, 300478, 2485, 2829, 2715, 2823, 2742, 2787, 2953, 300705, 2504, 300837, 300697, 300901, 534, 890, 2724, 2832, 301159, 300654, 300791, 300824, 2395, 2674, 301023, 301033, 668, 300416, 2858, 300281, 300909, 2209, 300905, 300960, 2199, 2896, 300405, 2499, 2921, 301022, 1211, 300851, 301043, 300964, 301076, 2836, 300583, 300749, 2586, 2633, 300396, 301042, 300611, 301031, 300656, 300916, 300971, 300169, 300557, 301062, 2122, 300512, 301016, 1206, 3023, 300488, 45, 2054, 2003, 2098, 2668, 2976, 300862, 301029, 300277, 509, 300029, 300410, 300913, 300912, 3005, 3026, 300683, 300150, 300946, 300606, 300768, 300941, 300993, 410, 300856, 300949, 301129, 2935, 2021, 300260, 300555, 300948, 301182, 590, 2983, 300293, 300650, 200488, 300800, 622, 2847, 2855, 300645, 2494, 3011, 300706, 300626, 2388, 200761, 300445, 300682, 2872, 300155, 300473, 300727, 3020, 300723, 2282, 300589, 300875, 301080, 3028, 2289, 2851, 3015, 300640, 2577, 2880, 300480, 301178, 403, 2553, 300341, 300848, 300835, 300840, 48, 3029, 300125, 300521, 2259, 3002, 300717, 2069, 2656, 2981, 2879, 3030, 300938, 301015, 300806, 300203, 300235, 409, 2535, 2989, 300419, 300523, 2592, 300126, 300667, 300726, 300935, 2859, 2977, 2899, 300525, 300643, 300820, 504, 1207, 2882, 3041, 300400, 300648, 300929, 803, 2687, 2866, 2884, 300399, 300720, 2969, 300542, 300453, 301009, 2618, 300530, 300543, 301097, 301118, 300378, 300709, 300943, 2753, 300109, 300680, 300385, 300813, 300861, 300871, 300982, 301017, 2186, 2861, 2893, 300290, 300491, 300887, 300951, 2322, 3013, 300176, 300422, 300602, 300733, 300863, 300335, 300818, 300838, 300847, 301070, 2868, 300790, 300854, 300892, 2678, 3003, 300330, 300394, 300715, 301004, 3012, 300535, 300786, 300947, 301177, 300939, 300314, 565, 659, 782, 737, 2211, 2250, 2875, 3038, 300629, 300864, 300814, 593, 720, 300570, 300634, 691, 2801, 300283, 300931, 2301, 300701, 300958, 2846, 2952, 300381, 300922, 301093, 300596, 300907, 300743, 300991, 1218, 300894, 300919, 2767, 2956, 300805, 2150, 2379, 2557, 300959, 2574, 300246, 300572, 300030, 300642, 571, 2694, 935, 2336, 300447, 300880, 301213, 2290, 2684, 2785, 2826, 300878, 300830, 300956, 300018, 300407, 2732, 2771, 300424, 300694, 300625, 948, 3018, 300226, 300331, 300898, 301025, 952, 2483, 300925, 300633, 996, 2147, 2769, 300660, 300895, 301049, 300167, 300187, 300282, 531, 2254, 2193, 300313, 300665, 301222, 300469, 2168, 3019, 2881, 301180, 200625, 32, 300520, 300685, 301248, 2321, 300457, 300975, 2595, 2825, 300514, 300942, 2501, 300032, 300329, 300624, 300780, 915, 200725, 300423, 301061, 300504, 300617, 2347, 2381, 300161, 300252, 300832, 301077, 2791, 300921, 2559, 300206, 301131, 300513, 300486, 300879, 300119, 300143, 300210, 300653, 301196, 300205, 2840, 300702, 702, 300365, 687, 300137, 300334, 300722, 301085, 2622, 300719, 300614, 300638, 300696, 300873, 2675, 300236, 301135, 17, 2669, 300940, 300430, 2817, 300429, 301198, 2484, 2995, 300139, 300307, 576, 2933, 300384, 301003, 96, 1872, 2809, 2818, 300120, 2820, 2472, 300493, 300599, 2996, 1216, 300342, 1696, 2654, 2877, 300162, 2982, 301127, 301055, 626, 300403, 300752, 2096, 300269, 300547, 301113, 2099, 300460, 301050, 2955, 300994, 300815, 1914, 2666, 300386, 300631, 2713, 2105, 2614, 300351, 300121, 2474, 3010, 2372, 2928, 2364, 2423, 300074, 300579, 2308, 300243, 920, 2850, 300050, 301087, 2115, 2641, 2698, 300134, 300135, 2253, 2790, 300084, 300565, 2238, 2316, 2965, 300608, 301001, 1289, 2117, 300860, 300882, 37, 2198, 300288, 300610, 300225, 300550, 2556, 610, 2755, 301237, 38, 828, 856, 2196, 1296, 300213, 300262, 300466, 300666, 300195, 2144, 2645, 1201, 2333, 300141, 300171, 300567, 2643, 300245, 759, 2800, 2798, 2970, 1234, 2287, 2303, 2878, 2516, 300842, 300781, 2387, 677, 2355, 300289, 300997, 881, 2300, 300471, 300561, 2985, 300872, 301268, 2225, 719, 2838, 3016, 300801, 300092, 300132, 567, 2107, 570, 2213, 300188, 300272, 301167, 2377, 2907, 300883, 300340, 300428, 885, 2998, 300545, 419, 976, 300234, 300295, 2428, 2638, 300005, 300785, 300323, 2123, 301186, 553, 2313, 2346, 2512, 2712, 300082, 2853, 818, 2026, 300712, 300620, 300783, 300945, 967, 2409, 2627, 300444, 300888, 301190, 2264, 2172, 300551, 852, 300264, 300057, 300201, 300302, 300619, 902, 2375, 2689, 300004, 300366, 300333, 300792, 2247, 300227, 300241, 300678, 2688, 2716, 301257, 407, 300775, 708, 2743, 2441, 2533, 2579, 300191, 300391, 300519, 520, 2040, 2298, 300740, 2863, 300196, 300649, 301116, 2467, 2705, 536, 2160, 2190, 301098, 712, 2288, 2546, 2608, 2094, 300180, 301207, 631, 2856, 300549, 301185, 62, 2523, 300041, 2087, 300770, 2320, 705, 300435, 2299, 301206, 2416, 300420, 2706, 300259, 2649, 300285, 300310, 823, 2093, 2733, 300072, 541, 2055, 2106, 301038, 2315, 2392, 301151, 300436, 300812, 300053, 2701, 2418, 301200, 2114, 2458, 2677, 2662, 150, 2597, 539, 766, 300613, 1308, 2353, 2626, 2587, 2047, 300869, 715, 2681, 923, 2210, 2968, 2113, 300308, 300022, 2471, 3037, 428, 566, 2943, 300981, 300456, 988, 2286, 300600, 666, 301047, 2221, 2332, 2344, 710, 300962, 2234, 2648, 518, 300168, 300582, 301058, 2495, 978, 300350, 2650, 300778, 2083, 300751, 2773, 2916, 300496, 2184, 300326, 2169, 300007, 300048, 627, 3021, 2141, 2747, 2780, 2908, 300177, 300328, 2028, 989, 2004, 958, 300485, 2363, 682, 415, 300443, 997, 301126, 2762, 785, 2020, 300165, 608, 300123, 301201, 836, 563, 300358, 596, 837, 300352, 31, 300044, 2130, 2545, 2988, 2950, 300933, 2605, 2987, 300184, 42, 2216, 2267, 300102, 300152, 533, 300200, 300664, 2073, 300244, 300157, 300636, 300198, 733, 2837, 408, 300263, 2434, 300232, 300533, 888, 300111, 2126, 300318, 2812, 300320, 426, 969, 2258, 2819, 417, 851, 300762, 301153, 529, 300145, 301027, 912, 2023, 2480, 301219, 300130, 2178, 2064, 2887, 300474, 300046, 751, 300279, 721, 2993, 999, 300133, 1219, 301216, 50, 2728, 2570, 301136, 711, 701, 2068, 558, 2270, 40, 2568, 26, 2222, 2005, 300745, 300081, 2217, 2328, 301256, 2885, 300086, 2461, 2498, 300379, 561, 300917, 2037, 676, 300098, 2659, 300896, 1228, 300233, 2999, 300584, 300240, 2621, 301111, 300049, 2551, 300688, 2164, 2562, 300359, 2177, 301060, 300741, 300655, 300569, 2015, 2520, 2059, 301217, 2421, 300181, 300623, 2165, 2702, 2386, 300035, 300164, 2229, 300297, 300061, 524, 777, 2373, 300437, 878, 2620, 1313, 2396, 300803, 726, 2436, 949, 301191, 300043, 727, 637, 300147, 789, 2723, 796, 2915, 300759, 530, 2468, 301163, 2518, 88, 2350, 300153, 300603, 657, 300831, 2036, 300217, 861, 49, 300033, 300101, 639, 2266, 423, 2189, 581, 2140, 2413, 2268, 951, 2310, 2693, 821, 2496, 89, 2807, 300398, 6, 2647, 2739, 2108, 636, 2076, 21, 301137, 786, 300558, 970, 732, 921, 300287, 545, 2081, 2302, 300497, 2725, 3035, 672, 2011, 300421, 300020, 2507, 300827, 2075, 2156, 300009, 2926, 301168, 598, 2737, 300363, 635, 300415, 488, 300083, 300450, 300773, 300748, 2948, 2447, 793, 300223, 498, 548, 2839, 300777, 738, 2249, 300013, 2389, 901, 300077, 2958, 2274, 2717, 2335, 300284, 2154, 918, 2530, 2205, 300002, 2038, 2194, 2860, 300595, 2235, 300136, 39, 300782, 2065, 2382, 753, 2601, 2334, 300346, 2252, 2429, 2869, 2673, 2342, 2759, 300304, 681, 2617, 300037, 975, 543, 300070, 2511, 862, 300253, 300724, 2655, 300144, 877, 928, 2542, 19, 2482, 300166, 2789, 300303, 790, 300383, 301089, 2135, 2463, 300601, 2584, 300413, 301179, 2162, 2414, 927, 300311, 2044, 2539, 2588, 2651, 2895, 300170, 300663, 985, 2575, 2049, 750, 2371, 300087, 301215, 300390, 2492, 301, 300091, 2435, 822, 993, 552, 2110, 680, 2080, 905, 2505, 930, 898, 2091, 2002, 2312, 2022, 2437, 300116, 2304, 816, 629, 300039, 1319, 2041, 2481, 825, 886, 2558, 300267, 2932, 2024, 2053, 300317, 46, 300052, 632, 58, 1979, 2272, 300003, 505, 300482, 300237, 2766, 1212, 2192, 709, 2230, 301160, 2639, 683, 778, 810, 519, 2506, 2600, 300189, 2531, 762, 961, 2185, 799, 2405, 300058, 300999, 819, 300031, 300088, 788, 983, 982, 2116, 2204, 2628, 2131, 2277, 926, 932, 425, 155, 157, 1213, 514, 300122, 977, 2280, 300433, 2941, 300023, 2236, 2195, 2550, 2571, 2251, 628, 300343, 2352, 582, 2380, 2127, 2455, 2027, 69, 860, 2309, 2007, 300117, 2431, 2602, 812, 758, 2676, 2613, 547, 650, 2202, 2738, 300140, 713, 2305, 338, 722, 776, 2444, 300274, 2864, 422, 63, 2176, 2750, 301298, 2665, 2610, 2555, 2607, 300026, 630, 2714, 2340, 2873, 9, 2475, 2383, 333, 968, 2265, 620, 301125, 3816, 100, 10, 909, 591, 2478, 2761, 2183, 736, 2594, 2, 625, 868, 2263, 1896, 151, 2426, 2432, 716, 619, 2349, 2323, 2218, 2630, 2699, 595]

    try:
        behave.TEST_mu_bat(data_source, all_inc, batch_nb=16, bgn_batch=0, SecurityIDSource=SecurityIDSource_SZSE, instrument_type=INSTRUMENT_TYPE.STOCK, logPack=logPack) #
    except Exception as e:
        logger.error(f'{traceback.format_exc()}')
