# -*- coding: utf-8 -*-

import traceback
import logging
import datetime
from time import localtime
import os
import behave.test.test_axob as behave
from tool.axsbe_base import INSTRUMENT_TYPE, SecurityIDSource_SZSE

if __name__== '__main__':
    myname = os.path.split(__file__)[1][:-3]
    mytime = str(datetime.datetime(*localtime()[:6])).replace(':',"").replace('-',"").replace(" ","_")

    logger = logging.getLogger('main')
    logger.setLevel(logging.DEBUG)

    fh = logging.FileHandler(f'log/{myname}_{mytime}.log')
    # fh = logging.FileHandler(f'log/{myname}.log', mode='w')
    fh.setLevel(logging.DEBUG)

    sh = logging.StreamHandler()
    sh.setLevel(logging.WARNING)

    formatter_ts = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
    formatter_nts = logging.Formatter('%(name)s - %(levelname)s - %(message)s')
    fh.setFormatter(formatter_nts)
    sh.setFormatter(formatter_ts)

    logger.addHandler(fh)
    logger.addHandler(sh)
    logPack = logger.debug, logger.info, logger.warn, logger.error

    ###测试20220617所有有委托的只股票，全天
    fh.setLevel(logging.WARN)
    sh.setLevel(logging.ERROR)
    logger.info('starting TEST_axob_bat')
    data_source = "H:/AXOB_data_newP/20220622/sbe_20220622_all.log"
    all_inc=[200706, 200045, 200613, 200030, 300069, 200530, 2072, 200020, 200992, 200512, 2499, 2319, 300622, 200521, 200019, 300656, 200037, 300354, 200055, 200429, 2919, 638, 200581, 2259, 200029, 300668, 300817, 300442, 300553, 2722, 2052, 504, 300489, 972, 300286, 502, 2872, 300103, 300475, 2356, 300434, 2700, 586, 2991, 300910, 3041, 300736, 2778, 301065, 200869, 301031, 301080, 3017, 300789, 410, 2485, 695, 200152, 2830, 300557, 2889, 300920, 2333, 301030, 300658, 2972, 300858, 301062, 2552, 301037, 301035, 300389, 300371, 2715, 300875, 3004, 3023, 2787, 300923, 2656, 2748, 2880, 668, 300650, 300982, 2742, 300960, 200539, 606, 2843, 301052, 820, 200012, 300938, 300845, 3036, 971, 300948, 2861, 300721, 300592, 1215, 301228, 301053, 300501, 3029, 300787, 200488, 2586, 300717, 509, 1210, 300723, 301117, 301042, 300990, 300813, 300549, 2817, 301006, 300697, 2819, 2984, 4, 300281, 2858, 301022, 2975, 301076, 806, 301036, 300554, 2983, 300321, 301041, 300862, 301182, 2855, 200761, 301119, 300808, 300345, 2796, 2921, 2767, 2541, 301073, 2501, 2835, 3027, 300768, 2098, 301193, 301106, 2719, 301108, 300824, 300538, 300837, 300851, 2953, 1209, 809, 2632, 300996, 300512, 2741, 2871, 300977, 300254, 300937, 300218, 3003, 300446, 300667, 2740, 301011, 300715, 300838, 3025, 300800, 300779, 2282, 300928, 300689, 300897, 300268, 300864, 300402, 300640, 1217, 421, 300820, 300980, 2293, 2231, 300594, 2781, 300822, 300196, 300211, 301012, 300939, 300847, 300440, 301099, 409, 300669, 2841, 300849, 2592, 803, 2949, 300540, 2977, 2147, 2763, 2917, 300654, 300430, 2755, 300819, 2910, 300929, 300854, 2634, 300391, 300380, 2829, 300202, 2102, 300356, 301086, 2250, 300761, 300641, 300882, 2973, 2609, 300394, 3033, 2825, 300290, 2875, 300979, 300878, 300269, 301222, 301051, 301179, 300892, 1296, 300758, 300406, 300953, 2198, 300563, 300749, 300298, 300206, 300385, 2853, 2338, 300880, 3015, 3016, 759, 300312, 300550, 300469, 301102, 2823, 2327, 301017, 2881, 300314, 300374, 300275, 2678, 301028, 300176, 301235, 300826, 2658, 300381, 300642, 300562, 697, 300799, 300573, 2901, 2150, 2952, 300652, 300746, 551, 300258, 300514, 565, 300480, 301002, 2653, 2845, 301180, 300801, 300591, 2694, 2484, 2961, 2790, 300575, 300399, 2086, 301023, 2313, 300852, 300210, 2811, 2962, 301020, 300515, 2993, 300616, 1202, 2193, 300973, 48, 2675, 300141, 300899, 301085, 300911, 300685, 301096, 300155, 300011, 2012, 300700, 2393, 2799, 300829, 2990, 626, 2696, 300871, 2016, 300703, 300351, 2366, 301077, 300462, 301013, 300520, 301061, 2735, 301110, 300902, 2040, 300425, 301162, 3031, 301185, 300453, 300873, 300349, 2096, 300358, 300961, 301055, 300586, 300488, 2643, 300908, 301279, 2556, 300106, 300461, 301149, 3018, 411, 2616, 300340, 2381, 2574, 301040, 2535, 300949, 300778, 301101, 691, 300995, 300455, 802, 300720, 2783, 593, 2377, 159, 300395, 300572, 300857, 300975, 26, 300776, 301135, 300270, 300649, 2114, 885, 301111, 301009, 301218, 2153, 300599, 300378, 300313, 1216, 300942, 301093, 5, 2566, 300513, 300957, 300375, 300951, 300175, 300247, 300610, 2186, 300382, 300519, 300931, 1288, 300805, 2838, 300331, 300105, 300771, 2404, 2521, 301181, 2196, 300143, 919, 818, 300589, 300628, 300448, 429, 300235, 705, 300722, 300403, 2032, 2077, 200725, 300762, 2357, 300242, 300005, 2850, 300055, 561, 300745, 2912, 300844, 2105, 955, 301000, 300344, 2931, 2622, 300032, 300988, 881, 856, 2809, 300493, 301091, 300500, 2860, 2960, 3019, 300460, 2644, 2438, 2451, 300262, 300120, 976, 2358, 300739, 301198, 301071, 300057, 300578, 2524, 2089, 995, 301212, 2695, 300630, 2006, 2528, 300191, 300215, 300547, 2897, 301004, 300436, 2902, 300119, 2933, 2275, 36, 300016, 300107, 301100, 2306, 2088, 300234, 300828, 2688, 300407, 2614, 2099, 300163, 707, 301103, 35, 301130, 603, 300933, 2287, 819, 300483, 2865, 301168, 301158, 300231, 300368, 419, 300322, 301131, 300730, 300518, 300859, 2084, 2583, 931, 2718, 852, 2593, 300084, 2627, 301206, 300619, 300365, 300243, 300100, 301038, 2591, 300969, 2368, 300042, 300987, 300992, 300725, 2479, 2782, 300941, 953, 300342, 2173, 2028, 2950, 2332, 300220, 62, 301137, 300167, 2138, 301021, 2969, 300883, 407, 300255, 300041, 2189, 2253, 2303, 300484, 1914, 2464, 911, 3021, 2474, 300638, 300336, 300169, 300823, 597, 2005, 2308, 2780, 300099, 2290, 300684, 2915, 785, 300621, 573, 300841, 300080, 3007, 300997, 301098, 150, 2546, 2655, 301007, 300018, 2254, 300452, 300962, 300338, 301133, 2301, 300236, 300842, 2887, 2144, 989, 2686, 2852, 2828, 2833, 300651, 2054, 300580, 2523, 2573, 2793, 2010, 300740, 2211, 300872, 2375, 301003, 2560, 300611, 2279, 2055, 2187, 622, 301027, 300674, 300485, 2876, 850, 300559, 2661, 300171, 2470, 2019, 2168, 300152, 1267, 301257, 1234, 2752, 900, 156, 300853, 2553, 300295, 300542, 300333, 300151, 520, 301151, 2299, 300582, 2772, 2148, 2418, 300783, 300067, 715, 300707, 985, 300881, 501, 300644, 300329, 301126, 2851, 300678, 300082, 300162, 300552, 962, 300195, 2674, 96, 300495, 2441, 973, 2650, 2369, 2818, 300690, 300869, 300160, 300605, 300692, 2042, 300240, 300802, 301138, 300850, 533, 300348, 2093, 1317, 28, 2106, 300896, 300404, 2773, 301107, 300252, 300412, 417, 2726, 2626, 2893, 16, 608, 2580, 2210, 300741, 2283, 958, 2516, 790, 2873, 981, 2515, 300248, 737, 300451, 2337, 300653, 2215, 300304, 2170, 300526, 801, 524, 2791, 2067, 301186, 300053, 300134, 2298, 300490, 300457, 88, 899, 300205, 300241, 701, 2440, 2582, 300543, 301056, 300180, 34, 415, 300227, 31, 530, 300738, 300310, 2659, 153, 300279, 301248, 300078, 2789, 300198, 2723, 2599, 300139, 300086, 2226, 300266, 2716, 300529, 2087, 2885, 300197, 1228, 2642, 2237, 300400, 2372, 2579, 905, 3037, 300363, 2434, 2859, 300332, 2406, 619, 2004, 301123, 300473, 2365, 2992, 300664, 301191, 2551, 2606, 300097, 997, 300021, 2677, 798, 300727, 300034, 2756, 928, 823, 2957, 2728, 2900, 2020, 2758, 2291, 2985, 2112, 300326, 2979, 300307, 2721, 300327, 2629, 2640, 2294, 300494, 2037, 2999, 300401, 300532, 2272, 300353, 717, 655, 2373, 2023, 300945, 300618, 300386, 2367, 529, 888, 300228, 300217, 2496, 2548, 58, 2468, 300306, 2572, 300165, 301219, 300130, 685, 300398, 2520, 555, 652, 791, 300770, 2248, 2130, 300068, 301072, 2076, 2774, 2713, 2141, 300328, 3039, 2178, 300894, 1201, 2015, 300763, 300420, 300496, 401, 300428, 1208, 2839, 975, 300408, 978, 300131, 2533, 996, 2222, 6, 300271, 2971, 686, 2227, 300113, 617, 2648, 301217, 557, 300316, 2408, 1203, 2491, 528, 61, 300267, 300292, 300556, 301153, 99, 300073, 2598, 3032, 612, 2201, 300319, 2707, 912, 761, 21, 917, 2234, 2135, 300063, 2048, 300443, 2883, 300159, 300177, 2136, 2151, 2646, 300132, 300027, 300147, 2941, 2274, 559, 2498, 2866, 2413, 537, 2011, 2660, 300603, 2745, 300657, 300145, 300047, 525, 2512, 539, 2267, 300663, 2284, 2169, 2892, 300748, 738, 2310, 2053, 2492, 2662, 969, 731, 607, 2689, 300676, 637, 3035, 2059, 862, 2100, 2244, 2493, 158, 301187, 2421, 2330, 2906, 2895, 2518, 2542, 300192, 49, 300188, 300568, 921, 2920, 2348, 2731, 2530, 2508, 2775, 2057, 300065, 300133, 2179, 2133, 300035, 758, 2323, 2266, 2938, 300324, 517, 2813, 300148, 2194, 2233, 726, 2708, 300505, 2510, 2564, 897, 300087, 2463, 300043, 925, 521, 300534, 300170, 883, 301226, 543, 301286, 300284, 615, 2223, 300199, 632, 2386, 2739, 300413, 300033, 2812, 2443, 498, 2162, 2455, 2433, 2166, 2502, 300070, 488, 402, 2065, 78, 592, 2288, 2156, 300803, 300366, 2966, 300251, 300793, 733, 554, 300299, 703, 2249, 2955, 999, 623, 2402, 2242, 599, 2191, 2588, 300773, 300001, 2750, 2988, 300376, 2435, 2958, 2567, 2139, 620, 2280, 300724, 2943, 2995, 2538, 2163, 300296, 300456, 3040, 633, 300114, 300846, 2132, 2429, 690, 2864, 2414, 300359, 2235, 2355, 628, 2457, 2363, 300115, 2110, 300039, 39, 12, 300760, 505, 797, 2529, 2550, 300613, 812, 2500, 2465, 882, 2125, 2343, 300569, 300110, 300264, 300083, 300077, 300677, 300158, 930, 681, 300623, 300075, 918, 2945, 2824, 2277, 878, 2307, 2044, 2918, 66, 301221, 795, 650, 300303, 2578, 836, 2374, 2182, 300017, 552, 300827, 27, 887, 2026, 2589, 570, 20, 2733, 768, 300510, 301298, 2152, 536, 2673, 300315, 2245, 683, 750, 2304, 300116, 968, 300821, 629, 2024, 2218, 413, 830, 2080, 716, 860, 2104, 880, 301266, 2681, 2002, 2036, 300003, 2101, 300393, 2666, 2271, 2936, 2456, 961, 300999, 895, 2292, 572, 667, 825, 546, 519, 2665, 300081, 2314, 2555, 2600, 2270, 300339, 155, 300477, 300222, 400, 2431, 875, 2094, 300468, 2142, 300224, 547, 1896, 2939, 300458, 2145, 300261, 960, 300337, 1227, 2537, 300136, 2197, 2305, 157, 2738, 29, 2013, 300364, 2273, 2008, 868, 2639, 1318, 709, 933, 2334, 2635, 2896, 595, 2459, 301156, 2326, 977, 2617, 2183, 300015, 2400, 2007, 702, 2624, 591, 63, 776, 338, 545, 300750, 2714, 2460, 300731, 2603, 2480, 300432, 671, 300026, 2559, 656, 9, 301199, 2340, 300274, 2176, 792, 2638, 630, 3816, 301220, 2174, 723, 2630, 589, 2047, 2927, 2160, 2709, 2657, 2056, 2466, 2241, 2, 678, 2594, 821, 627, 17, 1, 2204, 25, 2347, 2909, 625, 2703, 2239]

    try:
        behave.TEST_mu_bat(data_source, all_inc, batch_nb=16, bgn_batch=0, SecurityIDSource=SecurityIDSource_SZSE, instrument_type=INSTRUMENT_TYPE.STOCK, logPack=logPack) #
    except Exception as e:
        logger.error(f'{traceback.format_exc()}')
