# -*- coding: utf-8 -*-

import traceback
import logging
import datetime
from time import localtime
import os
import behave.test.test_axob as behave
from tool.axsbe_base import INSTRUMENT_TYPE, SecurityIDSource_SZSE

if __name__== '__main__':
    myname = os.path.split(__file__)[1][:-3]
    mytime = str(datetime.datetime(*localtime()[:6])).replace(':',"").replace('-',"").replace(" ","_")

    logger = logging.getLogger('main')
    logger.setLevel(logging.DEBUG)

    fh = logging.FileHandler(f'log/{myname}_{mytime}.log')
    # fh = logging.FileHandler(f'log/{myname}.log', mode='w')
    fh.setLevel(logging.DEBUG)

    sh = logging.StreamHandler()
    sh.setLevel(logging.WARNING)

    formatter_ts = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
    formatter_nts = logging.Formatter('%(name)s - %(levelname)s - %(message)s')
    fh.setFormatter(formatter_nts)
    sh.setFormatter(formatter_ts)

    logger.addHandler(fh)
    logger.addHandler(sh)
    logPack = logger.debug, logger.info, logger.warn, logger.error

    ###测试20220617所有有委托的只股票，全天
    fh.setLevel(logging.WARN)
    sh.setLevel(logging.ERROR)
    logger.info('starting TEST_axob_bat')
    data_source = "H:/AXOB_data_newP/20220621/sbe_20220621_all.log"
    all_inc=[200054, 200706, 200512, 200030, 200020, 200468, 200553, 200028, 200530, 200025, 200019, 200413, 200596, 300354, 2760, 201872, 2319, 2816, 752, 2692, 2072, 300795, 300736, 300668, 300442, 300522, 200029, 2742, 301068, 300789, 2740, 638, 2862, 300910, 300930, 2857, 695, 200152, 300553, 300695, 300817, 200017, 300446, 806, 2872, 2485, 2870, 301075, 300893, 3043, 200539, 200869, 300787, 300723, 301228, 2586, 2940, 301045, 300947, 300592, 2930, 300461, 300697, 2787, 3041, 300434, 300211, 300953, 45, 300756, 2691, 301041, 3033, 2295, 20, 820, 301097, 300517, 300928, 409, 300658, 300876, 300515, 2779, 300733, 300936, 301057, 300979, 301008, 300523, 300525, 300667, 301106, 301188, 534, 301065, 300097, 2331, 2778, 300521, 300549, 300416, 300392, 300417, 2802, 300816, 3029, 2159, 300720, 2719, 301030, 300312, 300721, 2861, 300056, 301062, 2748, 300596, 3023, 2785, 300615, 300277, 301076, 300852, 300650, 300964, 300905, 301016, 300445, 300840, 301199, 2282, 300321, 300501, 300836, 300577, 890, 590, 300862, 200488, 300960, 2827, 2553, 300488, 300901, 2632, 300625, 300564, 300864, 300489, 2188, 2832, 301159, 301049, 2921, 300154, 300959, 2947, 2360, 300758, 300380, 300566, 1217, 200012, 300635, 2871, 2264, 2684, 300330, 2810, 300855, 3025, 300538, 2881, 3017, 2835, 300023, 2819, 300293, 300753, 2333, 300915, 300149, 300815, 300218, 300963, 300790, 300892, 301099, 300717, 669, 300345, 301023, 2014, 2801, 300480, 301221, 2098, 300624, 2984, 301086, 300781, 300984, 300593, 300174, 803, 301022, 300899, 300975, 300990, 300419, 300854, 300791, 2577, 2209, 300948, 2231, 1210, 2732, 3003, 300440, 300254, 300176, 300880, 2122, 300378, 2313, 300802, 300424, 3036, 300206, 300641, 300210, 2102, 1207, 300929, 300877, 300966, 301167, 301083, 2768, 3018, 300996, 300938, 2134, 300682, 2846, 300729, 929, 2712, 300571, 300844, 301021, 300810, 300823, 2147, 2250, 300550, 3015, 2193, 300518, 300341, 2318, 300946, 300786, 611, 2845, 301009, 631, 300269, 300064, 300258, 300640, 300847, 301081, 300882, 300614, 2962, 301268, 2935, 2911, 801, 2641, 2792, 915, 300826, 300645, 2951, 300973, 1202, 300406, 565, 2990, 300629, 300422, 300325, 300609, 3042, 301056, 2970, 2674, 300940, 300587, 300829, 2882, 2973, 3005, 300968, 300820, 576, 300591, 3030, 300681, 2741, 301091, 2771, 300957, 2198, 301166, 531, 2168, 300469, 553, 659, 2559, 2790, 300126, 300675, 300805, 2783, 2086, 2848, 300220, 300993, 200725, 571, 300931, 301110, 300384, 2423, 300227, 300575, 300555, 2453, 300449, 2391, 301007, 2003, 2366, 2337, 2381, 300878, 300004, 301017, 2084, 301138, 300873, 300778, 300839, 301180, 300907, 301020, 2012, 300209, 300726, 2616, 301012, 300951, 2998, 677, 759, 300535, 300487, 301190, 1965, 2696, 300691, 301025, 2574, 2089, 300665, 3031, 300243, 300898, 2399, 609, 300573, 2521, 2096, 300425, 300969, 300908, 300300, 2148, 2799, 300761, 300638, 300022, 300016, 301082, 300942, 300504, 300245, 2322, 2853, 300701, 2090, 300042, 300767, 2306, 2841, 300187, 300270, 2430, 300556, 300092, 2811, 300464, 301102, 300344, 2838, 2186, 300680, 2107, 300956, 300137, 301186, 2850, 300563, 300608, 2658, 300125, 300335, 300470, 301177, 2986, 2180, 2901, 300586, 300076, 300630, 935, 2757, 300387, 2368, 300903, 301000, 2982, 300500, 5, 2345, 2946, 300109, 2225, 300949, 2949, 300334, 300594, 300599, 2336, 2743, 301098, 2718, 2856, 301222, 2301, 300628, 2618, 698, 2377, 300247, 300215, 301038, 300455, 159, 2005, 301069, 300429, 2117, 300543, 300647, 300472, 301130, 2462, 2528, 2793, 2690, 300631, 300493, 300548, 300809, 42, 2770, 300590, 2825, 2583, 2428, 300289, 300859, 869, 2925, 2809, 2897, 2055, 300051, 2879, 2105, 300005, 300547, 2774, 300231, 2398, 300195, 300580, 300495, 300766, 300785, 2956, 2229, 300700, 2645, 300260, 300866, 603, 2903, 301071, 2655, 2247, 300725, 301096, 2615, 301101, 300365, 2967, 300526, 301003, 881, 301027, 300776, 2409, 300712, 300072, 300747, 2184, 58, 2449, 3038, 300288, 300560, 300870, 300301, 2908, 301212, 300298, 2358, 301137, 300801, 300980, 818, 300883, 1696, 300718, 2515, 300273, 2451, 300412, 300617, 2253, 737, 300066, 300375, 2593, 520, 300683, 300340, 300739, 2017, 156, 785, 995, 911, 2815, 407, 2479, 300685, 301061, 2357, 300191, 1219, 419, 153, 2173, 2950, 2320, 2401, 2474, 2573, 300041, 2865, 300411, 300895, 2123, 2752, 2782, 2046, 2828, 635, 2452, 2979, 2099, 300332, 2254, 2082, 68, 300755, 1201, 300436, 300643, 300252, 962, 2387, 2416, 2959, 2627, 300193, 300642, 300168, 300684, 150, 300395, 919, 2683, 973, 301158, 300532, 300850, 300119, 2088, 2111, 2543, 1914, 2929, 300762, 720, 300057, 300367, 300483, 2063, 925, 1234, 300661, 31, 301149, 300080, 2775, 300404, 300336, 300403, 300649, 2706, 2547, 2649, 2010, 2033, 2523, 300769, 2931, 300867, 301200, 417, 2083, 2688, 300067, 985, 300169, 300576, 1205, 403, 597, 2332, 96, 1228, 952, 2524, 2303, 300943, 889, 300511, 967, 2591, 2614, 2392, 2286, 837, 28, 2054, 301078, 501, 2410, 55, 2161, 300479, 2346, 2279, 2442, 301151, 300046, 300128, 300715, 300578, 301127, 300259, 300232, 2138, 300213, 300911, 2136, 2294, 14, 2726, 300099, 300648, 300751, 300248, 300612, 2418, 2464, 2440, 300173, 2851, 608, 920, 2344, 922, 300674, 300338, 2928, 2262, 2375, 2605, 300467, 300558, 1289, 300896, 300102, 300048, 2968, 2115, 300485, 300165, 566, 2789, 35, 953, 300310, 2705, 300423, 555, 2441, 2106, 2490, 300240, 300985, 300917, 300992, 958, 300278, 2887, 300105, 300012, 2769, 300887, 666, 301103, 2299, 2765, 301136, 300435, 300151, 596, 59, 2039, 300988, 300582, 2996, 300506, 300038, 300350, 300212, 300055, 802, 913, 301256, 415, 3009, 3012, 2373, 300496, 823, 300738, 300130, 2397, 2445, 2563, 2351, 301191, 300618, 2417, 300451, 2570, 2020, 2311, 2243, 711, 523, 300044, 300127, 300093, 300266, 2728, 2278, 2471, 300741, 300692, 300294, 300465, 2652, 682, 300831, 426, 300264, 300194, 558, 600, 300113, 300559, 2458, 2165, 2290, 300653, 300894, 2085, 300120, 685, 300171, 518, 300234, 300588, 301120, 300584, 901, 300352, 300428, 2341, 999, 2323, 2758, 2697, 3006, 300690, 2957, 813, 300111, 2174, 888, 981, 300043, 533, 300086, 301248, 2178, 2150, 300157, 2693, 652, 796, 11, 2664, 619, 997, 2472, 300047, 300546, 300541, 2659, 893, 2037, 923, 2580, 969, 300702, 988, 2310, 301237, 301163, 301060, 2916, 300672, 300309, 300271, 300239, 2226, 61, 300184, 300351, 2486, 300600, 2701, 2130, 912, 617, 300317, 2023, 2562, 903, 528, 2075, 657, 300031, 2354, 2031, 886, 639, 301219, 2493, 300045, 839, 2579, 2116, 826, 2545, 300159, 950, 2288, 2154, 19, 2629, 910, 581, 2396, 301217, 838, 789, 559, 300007, 2274, 2048, 300020, 811, 300292, 300217, 2297, 2636, 2892, 300276, 300355, 507, 300267, 2237, 2623, 2011, 2662, 300148, 2038, 2068, 2461, 2043, 503, 300222, 300272, 300363, 738, 2222, 300253, 707, 301286, 300708, 2745, 2350, 2422, 300170, 300021, 949, 2682, 300613, 2805, 300013, 300095, 2669, 402, 897, 686, 300316, 3039, 301089, 3037, 2502, 861, 300655, 2389, 728, 89, 2922, 300284, 2179, 2568, 2233, 810, 300079, 300083, 727, 517, 2530, 2280, 793, 731, 2041, 2677, 300237, 2268, 301226, 598, 2235, 2314, 300507, 2276, 2232, 300353, 703, 2443, 2598, 2999, 563, 2938, 300002, 2434, 2285, 506, 300409, 883, 2217, 300204, 2596, 2988, 2498, 300945, 632, 300147, 700, 2731, 2723, 300019, 2158, 300068, 636, 300782, 2076, 90, 3032, 301183, 60, 2166, 2625, 3028, 2065, 423, 797, 2646, 2402, 300164, 300061, 300568, 729, 2145, 300347, 2599, 300623, 300070, 2806, 2053, 2135, 498, 2447, 301187, 3022, 300324, 2263, 521, 2673, 300249, 2026, 2078, 2081, 2510, 2284, 301266, 300413, 2152, 2739, 735, 2307, 3035, 301236, 2110, 300306, 2463, 2197, 2932, 739, 300115, 300192, 300415, 2657, 300280, 300223, 2971, 300477, 582, 2538, 2242, 2207, 589, 2640, 2270, 791, 300166, 300035, 2437, 2465, 300199, 2277, 716, 300458, 2578, 788, 2589, 2489, 963, 2812, 2555, 488, 2292, 2073, 2995, 2505, 2024, 2482, 2249, 2561, 2567, 2550, 733, 2529, 2866, 554, 2252, 2146, 2163, 519, 2508, 300602, 300110, 49, 300037, 2943, 880, 2192, 300748, 540, 300763, 768, 2612, 300772, 300603, 2057, 300233, 300364, 300677, 2600, 795, 300124, 300144, 2602, 2886, 66, 2824, 628, 799, 862, 552, 736, 2532, 300601, 2564, 599, 2205, 300118, 2035, 2617, 2459, 2132, 667, 825, 300821, 2002, 545, 2585, 2251, 568, 300303, 937, 300129, 2371, 301, 300116, 300846, 2444, 2049, 2312, 938, 2036, 300499, 2539, 895, 815, 300393, 300003, 538, 300999, 2753, 2008, 2997, 683, 968, 961, 300359, 10, 2127, 557, 546, 2426, 778, 831, 425, 300094, 2738, 300418, 155, 572, 767, 2503, 2185, 300142, 830, 69, 300158, 300569, 2355, 1896, 982, 722, 2125, 300088, 2635, 29, 2013, 2576, 157, 977, 2708, 300459, 2129, 2439, 2536, 2080, 300339, 909, 2121, 300433, 762, 966, 300660, 965, 876, 2638, 2164, 2460, 300052, 300432, 2380, 807, 836, 2939, 301155, 776, 2639, 595, 933, 547, 2407, 2155, 300337, 2126, 2681, 300274, 2610, 630, 2241, 792, 2607, 3816, 300731, 300891, 2415, 983, 2340, 2699, 2432, 100, 2202, 2594, 678, 2334, 858, 17, 2709, 2204, 300010, 1, 2703, 2909, 300059, 1270, 2157, 2454, 957, 2239]

    try:
        behave.TEST_mu_bat(data_source, all_inc, batch_nb=16, bgn_batch=0, SecurityIDSource=SecurityIDSource_SZSE, instrument_type=INSTRUMENT_TYPE.STOCK, logPack=logPack) #
    except Exception as e:
        logger.error(f'{traceback.format_exc()}')
