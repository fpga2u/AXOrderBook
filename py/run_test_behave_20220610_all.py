# -*- coding: utf-8 -*-

import traceback
import logging
import datetime
from time import localtime
import os
import behave.test.test_axob as behave
from tool.axsbe_base import INSTRUMENT_TYPE, SecurityIDSource_SZSE

if __name__== '__main__':
    myname = os.path.split(__file__)[1][:-3]
    mytime = str(datetime.datetime(*localtime()[:6])).replace(':',"").replace('-',"").replace(" ","_")

    logger = logging.getLogger('main')
    logger.setLevel(logging.DEBUG)

    fh = logging.FileHandler(f'log/{myname}_{mytime}.log')
    # fh = logging.FileHandler(f'log/{myname}.log', mode='w')
    fh.setLevel(logging.DEBUG)

    sh = logging.StreamHandler()
    sh.setLevel(logging.WARNING)

    formatter_ts = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
    formatter_nts = logging.Formatter('%(name)s - %(levelname)s - %(message)s')
    fh.setFormatter(formatter_nts)
    sh.setFormatter(formatter_ts)

    logger.addHandler(fh)
    logger.addHandler(sh)
    logPack = logger.debug, logger.info, logger.warn, logger.error

    ###测试20220610所有有委托的只股票，全天
    fh.setLevel(logging.WARN)
    sh.setLevel(logging.ERROR)
    logger.info('starting TEST_axob_bat')
    data_source = "H:/AXOB_data_newP/20220610/sbe_20220610_all.log"
    all_inc=[200020, 200054, 200512, 200613, 200468, 200530, 200028, 200550, 200017, 2917, 200026, 300870, 300371, 300354, 300953, 200505, 200025, 300789, 2319, 200055, 200056, 300995, 300089, 2200, 200596, 300069, 200058, 200429, 300955, 2735, 2058, 300489, 695, 2919, 200413, 301041, 300522, 2857, 301075, 300865, 971, 300515, 300518, 300654, 300103, 300811, 586, 200869, 301045, 2830, 2848, 300658, 2209, 200581, 2656, 301023, 7, 2499, 300695, 45, 300791, 668, 300286, 2741, 2890, 200541, 300592, 300125, 2816, 301059, 301053, 2473, 301062, 300512, 2633, 2930, 2931, 300980, 300426, 301033, 300798, 300845, 3029, 200539, 300721, 300817, 301081, 300833, 300694, 2870, 638, 2953, 301149, 300391, 300840, 300540, 300877, 300779, 2855, 2866, 300417, 300905, 301065, 2787, 300536, 300488, 301037, 300810, 300478, 300687, 2858, 300807, 3020, 300394, 300911, 300857, 300235, 1207, 300970, 1211, 2823, 301022, 301035, 300711, 300566, 300915, 300620, 2150, 809, 2909, 300993, 3027, 300897, 300475, 301029, 301031, 300321, 300913, 300523, 301011, 301070, 802, 2802, 300979, 2021, 23, 2668, 2940, 300796, 300753, 2632, 2880, 3002, 300824, 2631, 2975, 300797, 2034, 301228, 2892, 2977, 300645, 2842, 2333, 2810, 2881, 2792, 2653, 2159, 300922, 2896, 300290, 300402, 2871, 2937, 301066, 2219, 2188, 2553, 300820, 3003, 300277, 200488, 3025, 300971, 300594, 2921, 2090, 301015, 300434, 622, 300985, 300899, 2293, 300851, 697, 300938, 300886, 300854, 300950, 2295, 300713, 410, 300486, 300943, 3004, 2952, 2527, 300991, 3036, 300637, 300550, 300983, 2678, 300447, 301067, 300154, 2829, 301178, 2388, 300707, 2942, 301117, 300298, 692, 679, 300226, 300901, 300952, 301128, 2618, 300422, 300864, 300689, 300589, 300907, 803, 2559, 300949, 32, 300455, 300855, 300430, 301181, 3038, 300243, 3005, 300682, 300871, 2949, 300787, 300720, 300976, 300966, 2168, 301079, 2970, 531, 300616, 301077, 300056, 2193, 3043, 300809, 2849, 2865, 301056, 300939, 2609, 300823, 300385, 300179, 2984, 300691, 300916, 300514, 534, 300733, 300947, 301002, 2847, 300653, 301028, 301032, 300258, 2541, 2980, 2801, 2732, 300931, 300614, 301222, 300948, 300559, 300884, 2260, 1288, 2690, 2147, 300480, 301133, 301061, 300878, 611, 300501, 2198, 300064, 300965, 782, 300697, 2861, 2969, 301024, 605, 301186, 669, 300927, 300120, 301026, 300863, 300742, 300929, 3000, 300893, 2774, 300968, 300992, 300602, 300016, 301135, 300206, 1217, 300862, 300155, 2771, 1266, 300365, 300562, 2494, 300819, 300571, 301093, 2211, 2779, 300624, 300873, 421, 2859, 17, 300442, 301005, 301180, 2453, 2891, 2214, 2451, 300703, 2566, 300946, 300629, 2253, 2535, 300591, 300441, 2833, 301073, 2845, 300799, 301050, 2669, 300219, 409, 2452, 300556, 2484, 300617, 593, 301000, 2694, 300270, 300647, 2996, 301012, 590, 300481, 2910, 300786, 2712, 2360, 2901, 2381, 2595, 300628, 300673, 300813, 300660, 2321, 2322, 300214, 300577, 913, 3016, 2462, 300446, 2387, 915, 300570, 2362, 300139, 300535, 2973, 300424, 300500, 300449, 300457, 300987, 300209, 300719, 300119, 300307, 300830, 300234, 301162, 300429, 300106, 2960, 2809, 2404, 2278, 300815, 300625, 2700, 300283, 300942, 2014, 2825, 2238, 301213, 300285, 2907, 300951, 2698, 2719, 300357, 2379, 2501, 300860, 300959, 300576, 2469, 952, 300453, 300096, 300504, 300112, 2522, 300866, 301229, 300487, 955, 300765, 300849, 301199, 300375, 2306, 300739, 300291, 850, 2898, 301127, 300268, 1296, 300313, 587, 300011, 300254, 300464, 300879, 2153, 2502, 2743, 2275, 300093, 200725, 300493, 300025, 300994, 300329, 948, 300195, 300472, 2368, 1218, 300801, 2423, 2250, 300889, 2955, 300196, 2818, 300215, 300547, 300555, 300236, 300969, 536, 300847, 2186, 3001, 300630, 300631, 301086, 2695, 2998, 70, 300752, 2445, 300143, 2301, 2112, 2982, 2369, 200625, 300528, 2247, 2925, 300318, 2397, 300045, 976, 1216, 2918, 300678, 300510, 300466, 300302, 2196, 300727, 892, 2636, 2428, 2820, 300221, 856, 300005, 1210, 2115, 300300, 300382, 613, 300882, 301179, 300425, 2557, 2454, 2313, 301013, 301071, 300340, 300832, 2791, 300054, 2372, 300883, 1201, 301226, 541, 300997, 2029, 300427, 300057, 300107, 300192, 300282, 2967, 300730, 300762, 300080, 300978, 2479, 2560, 2808, 2614, 301111, 300132, 300247, 300245, 300128, 300161, 2815, 300526, 301003, 2430, 2225, 2094, 300867, 2343, 677, 301113, 2512, 300201, 300428, 678, 300333, 2757, 2905, 300167, 2852, 567, 2184, 2358, 885, 2713, 300793, 3026, 300531, 300605, 300859, 2733, 301087, 682, 2172, 2846, 2441, 300205, 2488, 300342, 300567, 300171, 2303, 300071, 2627, 2990, 300834, 520, 2308, 300506, 300941, 300369, 510, 2028, 300743, 2417, 2869, 2474, 2409, 1914, 2149, 300460, 2243, 2111, 301078, 2175, 300725, 429, 300627, 301101, 2148, 801, 300533, 301237, 708, 2248, 300842, 2997, 300135, 301038, 2902, 300888, 2022, 300621, 300933, 589, 698, 300232, 300188, 2533, 2813, 2355, 2068, 597, 411, 1308, 300651, 301200, 2638, 300439, 300781, 2025, 2597, 300412, 300700, 2378, 156, 2187, 566, 2985, 300751, 35, 2718, 300222, 301288, 300561, 2033, 2708, 300110, 2556, 38, 1289, 2576, 300113, 300238, 2279, 301025, 300770, 300397, 811, 300502, 301058, 300527, 2255, 2212, 300180, 300193, 2491, 553, 300783, 300007, 2662, 2928, 2648, 2689, 300248, 300755, 2788, 407, 300532, 300348, 300479, 2756, 300712, 2286, 2547, 300006, 573, 42, 300259, 989, 300926, 300137, 2726, 301268, 300040, 2097, 300273, 2344, 2950, 300692, 300022, 300012, 2020, 555, 300693, 2085, 301126, 785, 2130, 300981, 2283, 533, 300048, 301100, 2106, 300881, 2772, 300337, 2171, 2677, 300600, 150, 2005, 2042, 300178, 2747, 2114, 2721, 2751, 925, 2915, 300465, 2434, 301118, 301123, 301187, 2047, 2449, 2087, 2398, 301206, 300177, 300328, 3032, 2350, 300618, 2017, 301207, 2332, 666, 2119, 710, 2587, 2575, 608, 2297, 300366, 715, 2164, 300699, 2546, 2113, 2244, 300046, 2268, 300332, 300468, 2464, 733, 503, 2167, 300963, 2222, 2780, 300264, 300785, 2661, 2671, 2048, 300672, 300233, 300325, 300737, 2215, 2568, 2916, 300063, 300073, 2563, 990, 571, 2606, 301010, 900, 2035, 300131, 999, 300034, 301219, 300891, 300496, 300411, 300352, 2727, 300308, 301155, 2316, 2571, 300133, 2439, 300664, 430, 2581, 2217, 300086, 2642, 2226, 711, 2067, 300367, 31, 2262, 300456, 300199, 301193, 2805, 300021, 2679, 2006, 2495, 300558, 3039, 2276, 300204, 300945, 300420, 300145, 524, 300740, 2281, 300111, 300967, 2676, 917, 426, 826, 300047, 2650, 301151, 300081, 2755, 2570, 911, 300792, 2806, 2623, 701, 300415, 2011, 721, 836, 300896, 2291, 2938, 2267, 2446, 300409, 2299, 300463, 37, 2580, 596, 2084, 2646, 2026, 2520, 559, 300114, 301090, 2242, 300027, 2341, 300129, 2526, 2330, 528, 300477, 300497, 2334, 301136, 2664, 300759, 813, 877, 2165, 300623, 300848, 988, 2599, 2824, 2837, 300031, 2328, 2812, 558, 2270, 2189, 2486, 2413, 300379, 789, 888, 918, 761, 2258, 985, 2408, 959, 530, 300495, 21, 2137, 301158, 2746, 301153, 300079, 2923, 300002, 300198, 300256, 2132, 300008, 501, 901, 300552, 727, 2373, 2050, 2534, 300049, 11, 2530, 2310, 2508, 300037, 601, 2545, 2908, 2296, 300146, 735, 2162, 2860, 300253, 2031, 717, 2302, 2081, 951, 1228, 2370, 300483, 300297, 3035, 2926, 2266, 401, 300676, 300846, 2194, 970, 2468, 548, 550, 300017, 2079, 791, 2745, 300085, 2558, 609, 2697, 2635, 2612, 2436, 300355, 2723, 300474, 300296, 2402, 2261, 810, 2065, 2389, 1212, 301109, 779, 2447, 3009, 598, 2166, 300782, 2828, 90, 300035, 2759, 2135, 300370, 2542, 2274, 2154, 2693, 2037, 726, 300266, 488, 300347, 2152, 862, 2736, 543, 2252, 728, 800, 2325, 2383, 300701, 301131, 2932, 878, 819, 980, 793, 739, 60, 50, 300772, 404, 2078, 2235, 300421, 2091, 416, 2601, 2966, 707, 2051, 2156, 2201, 301089, 300507, 300224, 2660, 300688, 300001, 300401, 300311, 517, 700, 300115, 1313, 829, 2511, 2232, 300639, 19, 2476, 300157, 975, 2382, 2716, 2463, 300223, 300166, 2374, 300140, 2139, 2663, 2682, 300251, 882, 2958, 783, 2197, 2429, 12, 2550, 2437, 301160, 993, 300541, 2725, 300077, 2673, 39, 300158, 300237, 2883, 632, 2548, 2470, 2455, 1319, 513, 300124, 2169, 2766, 300560, 629, 758, 2057, 300033, 2342, 300159, 2489, 2617, 300091, 2717, 2589, 2496, 301215, 2647, 2049, 545, 301039, 795, 300390, 2941, 2125, 563, 812, 300393, 928, 2405, 300116, 2191, 529, 750, 2273, 898, 927, 2567, 2602, 2002, 2506, 300094, 2529, 300498, 650, 2565, 2425, 2160, 300603, 2185, 505, 300185, 300003, 737, 300039, 731, 963, 2939, 66, 2044, 875, 681, 2024, 301, 886, 839, 2245, 2146, 300364, 2538, 2519, 960, 2008, 2758, 883, 300058, 825, 937, 2104, 568, 961, 2317, 2657, 46, 2271, 2537, 655, 2041, 2208, 300122, 2639, 2230, 300339, 2555, 2444, 2652, 778, 300087, 572, 2251, 880, 2922, 709, 895, 300677, 2407, 425, 300014, 2352, 2487, 2195, 157, 2738, 300433, 2129, 301298, 815, 506, 2561, 983, 300118, 300432, 2155, 2554, 2142, 300261, 831, 300164, 2797, 2307, 2030, 96, 933, 582, 300075, 807, 2027, 2218, 702, 300343, 868, 9, 63, 998, 3022, 2256, 300274, 2157, 2739, 2999, 876, 2340, 584, 671, 982, 713, 722, 690, 2062, 2497, 2564, 2240, 723, 2380, 2349, 100, 792, 833, 2578, 2265, 2121, 2060, 2482, 2183, 2205, 2629, 2432, 651, 2594, 1, 2761, 1270, 625, 151, 966, 2478, 2061, 2699, 957]

    try:
        behave.TEST_mu_bat(data_source, all_inc, batch_nb=16, bgn_batch=1, SecurityIDSource=SecurityIDSource_SZSE, instrument_type=INSTRUMENT_TYPE.STOCK, logPack=logPack) #
    except Exception as e:
        logger.error(f'{traceback.format_exc()}')
