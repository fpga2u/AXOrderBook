# -*- coding: utf-8 -*-

import traceback
import logging
import datetime
from time import localtime
import os
import behave.test.test_axob as behave
from tool.axsbe_base import INSTRUMENT_TYPE, SecurityIDSource_SZSE

if __name__== '__main__':
    myname = os.path.split(__file__)[1][:-3]
    mytime = str(datetime.datetime(*localtime()[:6])).replace(':',"").replace('-',"").replace(" ","_")

    logger = logging.getLogger('main')
    logger.setLevel(logging.DEBUG)

    fh = logging.FileHandler(f'log/{myname}_{mytime}.log')
    # fh = logging.FileHandler(f'log/{myname}.log', mode='w')
    fh.setLevel(logging.DEBUG)

    sh = logging.StreamHandler()
    sh.setLevel(logging.WARNING)

    formatter_ts = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
    formatter_nts = logging.Formatter('%(name)s - %(levelname)s - %(message)s')
    fh.setFormatter(formatter_nts)
    sh.setFormatter(formatter_ts)

    logger.addHandler(fh)
    logger.addHandler(sh)

    ###测试20220617所有有委托的只股票，全天
    fh.setLevel(logging.WARN)
    sh.setLevel(logging.ERROR)
    logger.info('starting TEST_axob_bat')
    data_source = "data/20220617/sbe_20220617_all.log"
    all_inc=[200045, 200613, 200706, 200512, 200468, 200550, 200530, 200028, 200992, 300710, 200581, 300125, 200429, 200413, 2802, 200771, 200570, 300837, 300817, 300886, 200011, 301031, 300870, 200541, 2569, 2848, 300658, 2692, 2866, 300391, 300536, 301068, 301075, 300656, 752, 301042, 586, 2668, 638, 2740, 2700, 300553, 300478, 2830, 2203, 301057, 2917, 300434, 300539, 301008, 3004, 2778, 2787, 300371, 809, 300840, 300103, 300986, 300426, 301062, 300935, 300912, 2896, 200017, 2499, 301129, 2872, 300211, 2473, 2259, 2427, 3038, 301041, 300938, 301030, 301045, 300787, 300592, 301228, 2742, 301016, 2919, 300277, 300461, 300416, 300910, 2209, 410, 300950, 301063, 300489, 668, 300549, 2847, 300667, 2843, 301067, 300918, 300756, 806, 2724, 2796, 300979, 2282, 611, 2159, 300822, 300154, 300492, 534, 803, 300469, 300791, 3023, 3017, 300641, 2870, 300445, 300462, 2871, 2003, 2333, 2810, 2930, 300286, 300909, 906, 3003, 300550, 2021, 300905, 2832, 300733, 300522, 301015, 2485, 301011, 300897, 300852, 2331, 300991, 300851, 300862, 300659, 301199, 300902, 32, 2293, 2072, 300901, 2633, 301096, 300711, 300965, 3000, 3002, 2395, 200488, 300687, 2861, 300970, 301079, 300736, 300508, 301066, 300955, 2768, 300713, 300753, 300857, 3029, 2983, 301033, 403, 2730, 300480, 2090, 300875, 301083, 300440, 300948, 300378, 3028, 300996, 929, 300056, 300312, 2842, 551, 409, 2675, 300626, 300958, 2376, 300786, 301149, 301022, 2984, 300632, 300807, 301182, 301108, 2753, 300538, 300824, 2313, 2748, 300853, 300097, 2052, 300290, 2653, 2586, 301004, 300447, 300218, 300064, 301073, 300564, 2098, 2150, 300723, 300345, 301028, 301086, 300697, 300882, 300254, 301117, 2360, 300562, 300908, 1210, 300583, 300696, 300596, 2888, 3041, 300683, 300887, 2631, 300694, 300275, 300823, 300946, 2609, 300374, 300893, 2264, 300356, 301076, 300847, 300690, 2592, 300811, 2577, 2381, 300314, 300501, 2800, 1215, 2535, 300593, 300109, 300929, 590, 2290, 300503, 2732, 300985, 301222, 300030, 2963, 2827, 3015, 300634, 300380, 300767, 2841, 2949, 300525, 2016, 2147, 2940, 2767, 300202, 300818, 300715, 300206, 2858, 300268, 2875, 300726, 300628, 3008, 300778, 300466, 1218, 300774, 301043, 2755, 300993, 300863, 300565, 301077, 300966, 2989, 300470, 2979, 300610, 300730, 2903, 2856, 300616, 300856, 300864, 2850, 2977, 301081, 1207, 1217, 300983, 301056, 2937, 2186, 2527, 301135, 301032, 2040, 2672, 300669, 2998, 300927, 300514, 2615, 301180, 300509, 300385, 300742, 300349, 300230, 301040, 300684, 301279, 300873, 801, 2913, 300768, 2718, 300937, 300270, 30, 300633, 3042, 300719, 300138, 300617, 2817, 301047, 300214, 300411, 300155, 300631, 300648, 300998, 300877, 2451, 1202, 300951, 2420, 300765, 300425, 300441, 300419, 1205, 300096, 300422, 300005, 300573, 2616, 301093, 300176, 300011, 300963, 2180, 2808, 2254, 2892, 300781, 300644, 300913, 300016, 2318, 2798, 301229, 565, 300190, 300919, 301052, 3016, 2955, 300871, 300894, 859, 301091, 2819, 300285, 300120, 300813, 300567, 300647, 300978, 2114, 300849, 300805, 300755, 593, 300298, 2089, 300370, 300898, 200725, 300925, 300334, 3019, 301002, 2975, 2645, 301186, 2524, 300004, 300926, 300516, 2347, 2654, 1266, 301036, 2771, 2935, 300473, 300322, 48, 300523, 2009, 421, 2783, 5, 2627, 2346, 301009, 38, 300591, 300830, 2238, 300903, 300866, 300196, 301167, 2107, 2774, 3001, 2706, 301098, 2658, 300424, 300032, 2868, 2214, 2438, 300357, 2158, 300520, 301131, 301148, 300227, 301102, 2743, 2790, 300665, 2494, 2820, 300256, 2025, 301111, 2077, 300278, 2227, 2321, 1696, 2712, 2679, 300900, 300195, 856, 2469, 300580, 2811, 2086, 2479, 2967, 300761, 2918, 300825, 301150, 300107, 300161, 2644, 2184, 300279, 2138, 300832, 2898, 2501, 2785, 300526, 2430, 411, 300042, 35, 300504, 300201, 1296, 2863, 2368, 2734, 557, 2906, 300528, 885, 2095, 2442, 2860, 300226, 300992, 2900, 300941, 301069, 301127, 42, 300895, 2751, 2224, 2366, 2962, 300545, 2377, 300510, 301038, 300842, 300604, 301010, 300493, 300252, 766, 300427, 2423, 922, 300173, 869, 300554, 719, 2029, 2190, 300678, 2300, 510, 2173, 300221, 301177, 300548, 300454, 2566, 301118, 2399, 2671, 300812, 952, 300506, 300105, 301221, 300057, 1289, 300771, 2168, 850, 2576, 301288, 300722, 2148, 300137, 300320, 301070, 2357, 300608, 2403, 300404, 2705, 2620, 2019, 2428, 2416, 2689, 301003, 300291, 2117, 301133, 300785, 300788, 300457, 2611, 300605, 2799, 300048, 2112, 301189, 2028, 536, 2253, 2032, 300074, 300597, 705, 2544, 300739, 300579, 300340, 301107, 300436, 301162, 2686, 300867, 1267, 300472, 301100, 300054, 301058, 2464, 990, 2546, 2164, 2713, 819, 2161, 2105, 2920, 2488, 911, 300135, 300205, 300127, 2410, 300638, 2815, 300531, 300452, 995, 785, 300783, 300025, 300843, 300762, 2343, 2412, 2851, 300485, 2664, 967, 777, 301018, 300558, 1308, 300439, 2083, 301169, 36, 2286, 300071, 153, 2891, 2046, 2398, 300654, 2915, 301258, 300578, 2005, 2775, 300034, 300151, 300242, 300288, 2301, 2929, 892, 301048, 300560, 300988, 300272, 2361, 2840, 609, 2109, 985, 635, 300006, 407, 301263, 300969, 300040, 300636, 2587, 2378, 2441, 300078, 589, 2490, 2581, 300128, 300308, 301060, 300350, 300213, 2837, 2344, 902, 300171, 2726, 2959, 1201, 2141, 300581, 2571, 2324, 301185, 14, 300273, 2409, 1206, 300282, 2782, 2136, 2996, 596, 715, 2651, 300712, 601, 900, 913, 300732, 300276, 2189, 973, 300323, 2294, 300860, 300460, 2591, 156, 2779, 301116, 300212, 2650, 2491, 2204, 300499, 300165, 300132, 2606, 737, 300114, 2262, 889, 300240, 2140, 2572, 300313, 2043, 2540, 300044, 300038, 300193, 300304, 701, 823, 2622, 300643, 300327, 300700, 2383, 301158, 300180, 2037, 417, 2221, 852, 300310, 2350, 301085, 2010, 2805, 2887, 300738, 2039, 2758, 2969, 2351, 301256, 300737, 2298, 2873, 300309, 2047, 2640, 2520, 300229, 2063, 300502, 2073, 300200, 31, 2985, 2987, 790, 813, 2165, 300444, 2167, 2111, 300527, 300745, 2011, 6, 300494, 524, 300541, 2563, 738, 300769, 300369, 300172, 300497, 300244, 880, 2212, 300194, 2662, 2551, 733, 2149, 2119, 2446, 300740, 300238, 300552, 2470, 300598, 96, 301113, 300236, 59, 908, 652, 2676, 2137, 301151, 300299, 981, 2103, 2461, 989, 2237, 11, 2642, 300197, 300204, 950, 2486, 501, 300324, 2329, 300348, 2852, 2448, 2723, 901, 300366, 2693, 2999, 300111, 802, 2626, 300021, 300053, 2667, 2728, 300759, 529, 300146, 300585, 300181, 300770, 301163, 978, 2133, 2822, 2242, 65, 300496, 426, 779, 2417, 2296, 2765, 300248, 3007, 2916, 301109, 2545, 301120, 2608, 2982, 2468, 2276, 300727, 2902, 2038, 2201, 948, 607, 789, 666, 300576, 721, 2067, 2102, 2458, 300693, 2299, 300198, 300763, 2716, 300068, 2721, 2334, 2533, 2328, 657, 300792, 2988, 301219, 2232, 2685, 300671, 2562, 300131, 420, 2151, 899, 2406, 2310, 300049, 300160, 685, 300157, 300184, 726, 513, 301217, 2413, 40, 300468, 2725, 300098, 523, 300663, 300267, 2053, 2017, 559, 300352, 1317, 300047, 2093, 300147, 628, 2177, 2766, 300896, 301216, 300408, 300603, 949, 2314, 2223, 301089, 2941, 2646, 300036, 2747, 300101, 300827, 2135, 19, 2246, 2126, 2274, 301200, 632, 2270, 2542, 993, 2174, 558, 300463, 2045, 917, 300967, 300569, 300782, 300007, 2558, 300046, 2179, 2348, 786, 2208, 78, 918, 300360, 300253, 2051, 2745, 2818, 300612, 517, 300666, 970, 90, 2493, 2323, 2233, 300083, 2635, 2932, 300338, 2584, 300009, 878, 903, 507, 301110, 300217, 2746, 2267, 300264, 703, 300043, 2588, 300415, 300237, 2436, 2297, 2496, 2564, 2120, 300179, 927, 2465, 788, 301039, 2435, 2081, 672, 300997, 655, 2363, 2739, 2958, 887, 300347, 3037, 506, 2389, 300507, 2059, 300093, 2285, 678, 300008, 2538, 2374, 300533, 2554, 2255, 300390, 300699, 300505, 300773, 2249, 2280, 761, 300613, 300409, 2519, 2508, 2568, 598, 2065, 2268, 797, 300296, 300234, 2966, 300085, 300471, 2445, 2459, 2265, 300600, 2596, 2181, 951, 2079, 2041, 2036, 300170, 300039, 2414, 793, 882, 2444, 963, 300124, 2926, 158, 584, 300772, 2601, 758, 2437, 2824, 8, 2518, 2481, 3009, 2304, 968, 300144, 300081, 301215, 623, 300077, 2382, 2252, 2612, 690, 2325, 2207, 2489, 2492, 2589, 3040, 532, 300337, 300383, 66, 300456, 829, 300450, 2001, 2424, 2049, 893, 2500, 300401, 2532, 2579, 650, 488, 2309, 46, 408, 639, 300315, 2080, 300075, 930, 767, 2585, 2682, 716, 2750, 582, 2205, 1979, 898, 2402, 2578, 2457, 300224, 2995, 516, 2565, 300169, 563, 2074, 2505, 980, 2613, 300207, 552, 2307, 2194, 300377, 2339, 875, 2125, 1318, 300803, 400, 498, 2443, 568, 2256, 2384, 830, 2104, 2002, 2736, 2927, 629, 300999, 2191, 750, 683, 2092, 998, 783, 519, 825, 2531, 2665, 2245, 300261, 833, 546, 661, 3006, 2292, 736, 2487, 69, 2230, 2142, 300432, 895, 722, 2478, 300339, 1212, 2305, 713, 2030, 2503, 2513, 2582, 157, 680, 2380, 709, 301286, 800, 300364, 2806, 932, 425, 977, 831, 300433, 2121, 2197, 300343, 2269, 2251, 762, 2007, 2639, 300185, 983, 300015, 622, 2407, 1896, 2027, 2599, 2291, 2326, 2218, 933, 2714, 938, 960, 671, 2708, 300274, 2340, 630, 166, 338, 756, 17, 591, 700, 2475, 2502, 2101, 300359, 2460, 300750, 2610, 2761, 2385, 595, 2349, 2603, 2124, 723, 776, 665, 966, 2709, 301156, 858, 821, 2699, 300052, 815, 909, 2594, 2467, 300094, 1, 627, 2939, 2624, 2607, 725]

    try:
        behave.TEST_mu_bat(data_source, all_inc, batch_nb=16, bgn_batch=2, SecurityIDSource=SecurityIDSource_SZSE, instrument_type=INSTRUMENT_TYPE.STOCK) #
    except Exception as e:
        logger.error(f'{traceback.format_exc()}')
